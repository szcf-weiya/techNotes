
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="技术博客">
      
      
        <meta name="author" content="weiya">
      
      
        <link rel="canonical" href="https://tech.hohoweiya.xyz/shell/">
      
      
        <link rel="prev" href="../Linux/tools/">
      
      
        <link rel="next" href="../Linux/wsl/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.1">
    
    
      
        <title>Shell Scripts - techNotes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.402914a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    

  

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1JWL5Y1W90"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1JWL5Y1W90');
  </script>
  <script data-ad-client="ca-pub-3680148472128768" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#shell-scripts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="techNotes" class="md-header__button md-logo" aria-label="techNotes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            techNotes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Shell Scripts
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/szcf-weiya/techNotes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    szcf-weiya/techNotes
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Linux/" class="md-tabs__link md-tabs__link--active">
        Linux
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../comparisons/stat/" class="md-tabs__link">
        StatProgramming
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../Cpp/" class="md-tabs__link">
        CSProgramming
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../TeX/" class="md-tabs__link">
        DocProgramming
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Internet/sci-int/" class="md-tabs__link">
        Network/Internet
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../autotools/" class="md-tabs__link">
        Development
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../stats/prob/" class="md-tabs__link">
        Stat
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../biology/samtools/" class="md-tabs__link">
        InvitedPosts
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../English/" class="md-tabs__link">
        Misc
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="techNotes" class="md-nav__button md-logo" aria-label="techNotes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    techNotes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/szcf-weiya/techNotes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    szcf-weiya/techNotes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Laptops
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Laptops
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/ubuntu/" class="md-nav__link">
        Ubuntu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/software/" class="md-nav__link">
        Application Software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/tools/" class="md-nav__link">
        Command-line Tools
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Shell Scripts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Shell Scripts
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#special-parameters" class="md-nav__link">
    Special Parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer-bash-script" class="md-nav__link">
    Safer bash script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#double-exclamation" class="md-nav__link">
    Double Exclamation (!!)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell-builtin-vs-shell-keyword" class="md-nav__link">
    shell builtin vs shell keyword
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#line-begin-with" class="md-nav__link">
    line begin with :
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell变量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iterators-in-for-loop" class="md-nav__link">
    iterators in for loop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    String
  </a>
  
    <nav class="md-nav" aria-label="String">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quotes" class="md-nav__link">
    Quotes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strip-first-2-characters" class="md-nav__link">
    strip first 2 characters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strip-from-left-or-right" class="md-nav__link">
    strip from left or right
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-last-character" class="md-nav__link">
    remove last character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-character" class="md-nav__link">
    replace character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-value" class="md-nav__link">
    default value
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array" class="md-nav__link">
    Array
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-link-url-label" class="md-nav__link">
    Image Link -&gt; URL + Label
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-images-local" class="md-nav__link">
    External Images -&gt; Local
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git-init-date-as-post-date" class="md-nav__link">
    Git Init Date as Post Date
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rename-in-batch" class="md-nav__link">
    Rename in Batch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    统计访问日志里每个 ip 访问次数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#split-string-while-reading-files" class="md-nav__link">
    split string while reading files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribute-jobs-into-queues" class="md-nav__link">
    distribute jobs into queues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-arguments" class="md-nav__link">
    Command line arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-elements-of-an-array-in-bash" class="md-nav__link">
    join elements of an array in Bash
  </a>
  
    <nav class="md-nav" aria-label="join elements of an array in Bash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-more-complex-way" class="md-nav__link">
    A more complex way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#globbing-for-ls-vs-regular-expression-for-find" class="md-nav__link">
    globbing for ls vs regular expression for find
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-ifs" class="md-nav__link">
    Multiple IFS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    链接自动推送
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-path-of-the-current-script" class="md-nav__link">
    Get path of the current script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-statement" class="md-nav__link">
    if statement
  </a>
  
    <nav class="md-nav" aria-label="if statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#devnull" class="md-nav__link">
    &amp;&gt; /dev/null
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-operation" class="md-nav__link">
    logical operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-if-uid-equals-gid" class="md-nav__link">
    check if uid equals gid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sum-parameters" class="md-nav__link">
    sum parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-string" class="md-nav__link">
    test string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-file" class="md-nav__link">
    test file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aka-test-vs" class="md-nav__link">
    [ (aka test) vs [[
  </a>
  
    <nav class="md-nav" aria-label="[ (aka test) vs [[">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    $[
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vs-vs-eq" class="md-nav__link">
    = vs == vs -eq
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grep-keep-the-first-line-use-sed-instead" class="md-nav__link">
    grep keep the first line (use sed instead)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-two-blocks-in-a-txt-file" class="md-nav__link">
    compare two blocks in a txt file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#as-trycatch" class="md-nav__link">
    || as try...catch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replace-a-multiple-line-string" class="md-nav__link">
    Replace a multiple line string
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cut-lines-from-large-file" class="md-nav__link">
    Cut Lines from Large File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-lines-in-large-file" class="md-nav__link">
    Delete Lines in Large File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redirection-and-file-descriptor" class="md-nav__link">
    Redirection and File Descriptor
  </a>
  
    <nav class="md-nav" aria-label="Redirection and File Descriptor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hide-output-from-bg-process" class="md-nav__link">
    hide output from bg process
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-lines-based-on-2nd-file" class="md-nav__link">
    select lines based on 2nd file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vs" class="md-nav__link">
    &amp;&amp; vs ;
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/wsl/" class="md-nav__link">
        WSL
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_6" id="__nav_2_2_6_label" tabindex="0">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_6">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/blog/2020-08-25-PSSD/" class="md-nav__link">
        Portable SSD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/blog/2020-09-01-charge-battery-adaptively/" class="md-nav__link">
        Charge Battery Adaptively
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/blog/2021-06-07-switch-monitor/" class="md-nav__link">
        Switch Monitor Mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/blog/2021-07-28-use-old-kernel/" class="md-nav__link">
        Use Old Kernel
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Servers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Servers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/servers/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/ecs/" class="md-nav__link">
        AliECS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/rocky-server/" class="md-nav__link">
        Rocky-Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/asAserver/" class="md-nav__link">
        G40
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          CHPC-Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          CHPC-Cluster
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/chpc/" class="md-nav__link">
        Tips
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4_2" id="__nav_2_4_2_label" tabindex="0">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4_2">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/blog/2020-12-17-passwordless-failed/" class="md-nav__link">
        Fail to SSH passwordlessly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/blog/2021-05-12-fail-to-access-home/" class="md-nav__link">
        Fail to Access Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/blog/2022-11-19-why-job-restart/" class="md-nav__link">
        Why Job Restart?
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          StatProgramming
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          StatProgramming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparisons/stat/" class="md-nav__link">
        Comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          R
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          R
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R/plot/" class="md-nav__link">
        Plot
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2_3" id="__nav_3_2_3_label" tabindex="0">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2_3">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R/legend_from_zhihu/" class="md-nav__link">
        ggplot2 中的 legend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R/sample/" class="md-nav__link">
        new sample function (v3.6.0+)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R/factor/" class="md-nav__link">
        一道与 factor 有关的问题
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/conda/" class="md-nav__link">
        Conda
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/opencv/" class="md-nav__link">
        OpenCV
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/rpy2/" class="md-nav__link">
        rpy2
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3_5" id="__nav_3_3_5_label" tabindex="0">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3_5">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/pystan/" class="md-nav__link">
        PyStan 体验
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/esltag/" class="md-nav__link">
        自建关键词索引页
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Julia
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Julia
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../julia/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../julia/plot/" class="md-nav__link">
        Plot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Matlab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Matlab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Matlab/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SAS/" class="md-nav__link">
        SAS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          CSProgramming
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          CSProgramming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          C/C++
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          C/C++
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Cpp/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Cpp/Qt/" class="md-nav__link">
        Qt
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../java/" class="md-nav__link">
        Java
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          SQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SQL/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R/install-notes-for-rmysql/" class="md-nav__link">
        RMySQL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cuda/" class="md-nav__link">
        Cuda
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          DocProgramming
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          DocProgramming
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
      
      
      
        <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
          TeX
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          TeX
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/CI/" class="md-nav__link">
        TravisCI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/arxiv/" class="md-nav__link">
        arXiv
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/vargreek/" class="md-nav__link">
        VarGreek
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../TeX/overleaf/" class="md-nav__link">
        Overleaf
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          Markdown
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Markdown
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../doc/markdown/" class="md-nav__link">
        General
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          StaticPages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          StaticPages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../website/" class="md-nav__link">
        Website
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../website/disqus/" class="md-nav__link">
        Disqus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../website/css/" class="md-nav__link">
        CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../js/" class="md-nav__link">
        JS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../website/analytics/" class="md-nav__link">
        Analytics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
      
      
      
        <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
          DynamicPages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          DynamicPages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../PHP/" class="md-nav__link">
        PHP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../website/xampp/" class="md-nav__link">
        XAMPP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Network/Internet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Network/Internet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Internet/sci-int/" class="md-nav__link">
        科学上网
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Internet/" class="md-nav__link">
        一般问题
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Internet/ipv6/" class="md-nav__link">
        IPv6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Internet/encrypt/" class="md-nav__link">
        加密算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../autotools/" class="md-nav__link">
        Autotools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev/docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phantomjs/" class="md-nav__link">
        Phantomjs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Stat
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Stat
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stats/prob/" class="md-nav__link">
        Probability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stats/" class="md-nav__link">
        Statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scientific/" class="md-nav__link">
        Scientific
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stats/matrix/" class="md-nav__link">
        Matrix
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          InvitedPosts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          InvitedPosts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../biology/samtools/" class="md-nav__link">
        Samtools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/maximum-usage-of-ITSC-cluster-resource/" class="md-nav__link">
        MaxClusterUsage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          Misc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../English/" class="md-nav__link">
        English
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guitar/" class="md-nav__link">
        Guitar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../win/" class="md-nav__link">
        Windows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../biology/" class="md-nav__link">
        Biology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../finance/" class="md-nav__link">
        Finance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fresh/" class="md-nav__link">
        Fresh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../links/" class="md-nav__link">
        Links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/live/" class="md-nav__link">
        Live
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/wx/" class="md-nav__link">
        小程序
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/wxjssdk/" class="md-nav__link">
        jssdk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/report/" class="md-nav__link">
        讲座
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mi/" class="md-nav__link">
        Mi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/terms/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#special-parameters" class="md-nav__link">
    Special Parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer-bash-script" class="md-nav__link">
    Safer bash script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#double-exclamation" class="md-nav__link">
    Double Exclamation (!!)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell-builtin-vs-shell-keyword" class="md-nav__link">
    shell builtin vs shell keyword
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#line-begin-with" class="md-nav__link">
    line begin with :
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell变量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iterators-in-for-loop" class="md-nav__link">
    iterators in for loop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#string" class="md-nav__link">
    String
  </a>
  
    <nav class="md-nav" aria-label="String">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quotes" class="md-nav__link">
    Quotes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strip-first-2-characters" class="md-nav__link">
    strip first 2 characters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strip-from-left-or-right" class="md-nav__link">
    strip from left or right
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-last-character" class="md-nav__link">
    remove last character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-character" class="md-nav__link">
    replace character
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-value" class="md-nav__link">
    default value
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#array" class="md-nav__link">
    Array
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-link-url-label" class="md-nav__link">
    Image Link -&gt; URL + Label
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-images-local" class="md-nav__link">
    External Images -&gt; Local
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git-init-date-as-post-date" class="md-nav__link">
    Git Init Date as Post Date
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rename-in-batch" class="md-nav__link">
    Rename in Batch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    统计访问日志里每个 ip 访问次数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#split-string-while-reading-files" class="md-nav__link">
    split string while reading files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribute-jobs-into-queues" class="md-nav__link">
    distribute jobs into queues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-arguments" class="md-nav__link">
    Command line arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-elements-of-an-array-in-bash" class="md-nav__link">
    join elements of an array in Bash
  </a>
  
    <nav class="md-nav" aria-label="join elements of an array in Bash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-more-complex-way" class="md-nav__link">
    A more complex way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#globbing-for-ls-vs-regular-expression-for-find" class="md-nav__link">
    globbing for ls vs regular expression for find
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-ifs" class="md-nav__link">
    Multiple IFS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    链接自动推送
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-path-of-the-current-script" class="md-nav__link">
    Get path of the current script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-statement" class="md-nav__link">
    if statement
  </a>
  
    <nav class="md-nav" aria-label="if statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#devnull" class="md-nav__link">
    &amp;&gt; /dev/null
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-operation" class="md-nav__link">
    logical operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-if-uid-equals-gid" class="md-nav__link">
    check if uid equals gid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sum-parameters" class="md-nav__link">
    sum parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-string" class="md-nav__link">
    test string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-file" class="md-nav__link">
    test file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aka-test-vs" class="md-nav__link">
    [ (aka test) vs [[
  </a>
  
    <nav class="md-nav" aria-label="[ (aka test) vs [[">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    $[
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vs-vs-eq" class="md-nav__link">
    = vs == vs -eq
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grep-keep-the-first-line-use-sed-instead" class="md-nav__link">
    grep keep the first line (use sed instead)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compare-two-blocks-in-a-txt-file" class="md-nav__link">
    compare two blocks in a txt file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#as-trycatch" class="md-nav__link">
    || as try...catch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replace-a-multiple-line-string" class="md-nav__link">
    Replace a multiple line string
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cut-lines-from-large-file" class="md-nav__link">
    Cut Lines from Large File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-lines-in-large-file" class="md-nav__link">
    Delete Lines in Large File
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redirection-and-file-descriptor" class="md-nav__link">
    Redirection and File Descriptor
  </a>
  
    <nav class="md-nav" aria-label="Redirection and File Descriptor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hide-output-from-bg-process" class="md-nav__link">
    hide output from bg process
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-lines-based-on-2nd-file" class="md-nav__link">
    select lines based on 2nd file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vs" class="md-nav__link">
    &amp;&amp; vs ;
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="shell-scripts">Shell Scripts<a class="headerlink" href="#shell-scripts" title="Permanent link">&para;</a></h1>
<p>教程参考</p>
<ol>
<li><a href="http://www.runoob.com/linux/linux-shell.html">菜鸟教程</a></li>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/index.html#SEC_Contents">GNU Bash Reference Manual</a></li>
</ol>
<h2 id="special-parameters">Special Parameters<a class="headerlink" href="#special-parameters" title="Permanent link">&para;</a></h2>
<ul>
<li><code>$?</code>: 用于保存刚刚执行的命令的状态返回值<ul>
<li>0: 成功执行； </li>
<li>1-255: 表示执行失败</li>
<li>2: All builtins return an exit status of 2 to indicate incorrect usage, generally invalid options or missing arguments.</li>
<li>126: If a command is found but is not executable, the return status</li>
<li>127: If a command is not found, the child process created to execute it returns</li>
<li>128+N: When a command terminates on a fatal signal whose number is N, Bash uses the value 128+N as the exit status.</li>
<li>refer to <a href="https://www.gnu.org/software/bash/manual/html_node/Exit-Status.html">GNU Bash manual: 3.7.5 Exit Status</a> for more details.</li>
</ul>
</li>
<li><code>$*</code>, <code>$@</code>: 引用参数。Expands to the positional parameters, starting from one.</li>
<li><code>$#</code>: 位置参数的个数</li>
<li><code>$0</code>: 脚本名称</li>
<li><code>$!</code>: the process ID of the job most recently placed into the background</li>
<li><code>$$</code>: the process ID of the shell</li>
</ul>
<p>refer to</p>
<ul>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Special-Parameters.html">GNU Bash manual: 3.4.2 Special Parameters</a></li>
</ul>
<h2 id="safer-bash-script">Safer bash script<a class="headerlink" href="#safer-bash-script" title="Permanent link">&para;</a></h2>
<p>Came across some scripts <a href="https://github.com/jperkel/nature_bash/blob/e37ef568e81046207befaadd9872931c68a821ce/01_init.sh#L5">jperkel/nature_bash</a> start with </p>
<div class="highlight"><pre><span></span><code><span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail
</code></pre></div>
<p>or <a href="https://github.com/huan/docker-wechat/blob/291c281df1ab6806156c286c7df1464b71eee2d1/dochat.sh#L11">docker-wechat/dochat.sh</a></p>
<div class="highlight"><pre><span></span><code><span class="nb">set</span><span class="w"> </span>-eo<span class="w"> </span>pipefail
</code></pre></div>
<p>both of which provide safeguards.</p>
<ul>
<li><code>-e</code>: cause a bash script to exit immediately when a command fails</li>
<li><code>-o pipefail</code>: set the exit code of a pipeline to that of the rightmost command to exit with a non-zero status, or to zero if all commands of the pipeline exit successfully.</li>
<li><code>-u</code>: treat unset variables as an error and exit immediately</li>
</ul>
<p>refer to</p>
<ul>
<li><a href="https://vaneyckt.io/posts/safer_bash_scripts_with_set_euxo_pipefail/">Safer bash scripts with &lsquo;set -euxo pipefail&rsquo;</a></li>
<li><a href="https://blog.csdn.net/t0nsha/article/details/8606886">解释bash脚本中set -e与set -o pipefail的作用</a></li>
</ul>
<h2 id="double-exclamation">Double Exclamation (!!)<a class="headerlink" href="#double-exclamation" title="Permanent link">&para;</a></h2>
<p><code>!!</code> would execute the previous command. I found it when I type a git commit message like <code>!!! XXX</code>, which renders as <code>PREVIOUS COMMAND! XXX</code>, see <a href="https://github.com/szcf-weiya/en/commit/aa3c536847ae9563bf3e892d7f144725b7f7314a"><img alt="🔗" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f517.svg" title=":link:" /></a> for details. See also <a href="https://stackoverflow.com/questions/24980679/double-exclamation-in-bash-script"><img alt="🔗" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f517.svg" title=":link:" /></a>.</p>
<h2 id="shell-builtin-vs-shell-keyword">shell builtin vs shell keyword<a class="headerlink" href="#shell-builtin-vs-shell-keyword" title="Permanent link">&para;</a></h2>
<p>For <code>time</code> command, </p>
<p><img alt="image" src="https://user-images.githubusercontent.com/13688320/188676132-5ee17497-578a-4e41-abb5-0dc25f92ed5e.png" /></p>
<ul>
<li>in bash shell, it calls its builtin command, which is a shell keyword</li>
</ul>
<div class="highlight"><pre><span></span><code>~$<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="nb">time</span>
<span class="nb">time</span><span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>shell<span class="w"> </span>keyword
</code></pre></div>
<ul>
<li>on the other hand, in sh shell, it calls its builtin command, which refers to <code>/usr/bin/time</code></li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="nb">time</span>
<span class="nb">time</span><span class="w"> </span>is<span class="w"> </span>/usr/bin/time
</code></pre></div>
<p>So, as mentioned in <code>man time</code>, the full path <code>/usr/bin/time</code> is necessary in bash shell.</p>
<blockquote>
<p>Users of the bash shell need to use an explicit path in order to run the external time command and not the shell builtin variant.  On system where time is installed in
      /usr/bin, the first example would become
           /usr/bin/time wc /etc/hosts</p>
</blockquote>
<ul>
<li><a href="https://askubuntu.com/questions/445749/whats-the-difference-between-shell-builtin-and-shell-keyword">https://askubuntu.com/questions/445749/whats-the-difference-between-shell-builtin-and-shell-keyword</a></li>
</ul>
<h2 id="line-begin-with">line begin with <code>:</code><a class="headerlink" href="#line-begin-with" title="Permanent link">&para;</a></h2>
<p>came across in <code>R_HOME/etc/ldpaths</code> when I am investigating the loading issue of conda env from rstudio, <a href="https://github.com/szcf-weiya/techNotes/issues/32#issuecomment-881508987">https://github.com/szcf-weiya/techNotes/issues/32#issuecomment-881508987</a></p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;/media/weiya/PSSD/Programs/anaconda3/envs/R4.1.0/lib&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
:<span class="w"> </span><span class="si">${</span><span class="nv">R_LD_LIBRARY_PATH</span><span class="p">=</span><span class="si">${</span><span class="nv">R_HOME</span><span class="si">}</span><span class="p">/lib:/media/weiya/PSSD/Programs/anaconda3/envs/R4.1.0/lib</span><span class="si">}</span>
<span class="k">else</span>
:<span class="w"> </span><span class="si">${</span><span class="nv">R_LD_LIBRARY_PATH</span><span class="p">=</span><span class="si">${</span><span class="nv">R_HOME</span><span class="si">}</span><span class="p">/lib</span><span class="si">}</span>
<span class="k">fi</span>
</code></pre></div>
<p>I am guessing it is also a grammar for variable assignment, and someone (refer to <a href="https://stackoverflow.com/questions/32342841/colon-at-the-beginning-of-line-in-docker-entrypoint-bash-script">Colon at the beginning of line in docker entrypoint bash script - Stack Overflow</a>) has explained that</p>
<blockquote>
<p><code>:</code> is a no-op command: that is, it doesn&rsquo;t do anything, but arguments are evaluated normally. Contrast this with a comment (<code>#</code>), which does nothing at all (everything following the <code>#</code> is simply ignored).</p>
</blockquote>
<p>also check <a href="https://stackoverflow.com/questions/3224878/what-is-the-purpose-of-the-colon-gnu-bash-builtin">What is the purpose of the : (colon) GNU Bash builtin? - Stack Overflow</a></p>
<h2 id="shell">shell变量<a class="headerlink" href="#shell" title="Permanent link">&para;</a></h2>
<ol>
<li>定义变量时，变量名不加美元符号</li>
<li>变量名和等号之间不能有空格</li>
<li>变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界，比如下面 <code>for</code> 循环中举的 <code>${skill}</code> 例子。</li>
</ol>
<h2 id="iterators-in-for-loop">iterators in <code>for</code> loop<a class="headerlink" href="#iterators-in-for-loop" title="Permanent link">&para;</a></h2>
<ul>
<li>separated by space</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>skill<span class="w"> </span><span class="k">in</span><span class="w"> </span>Ada<span class="w"> </span>Coffe<span class="w"> </span>Action<span class="w"> </span>Java<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;I am good at </span><span class="si">${</span><span class="nv">skill</span><span class="si">}</span><span class="s2">Script&quot;</span>
<span class="k">done</span>
</code></pre></div>
<ul>
<li><code>start..stop..length</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">5</span>..50..5<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$i</span>
<span class="k">done</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Not valid in <code>sh</code>, and use it with <code>bash</code>!
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>./sumbit_job.sh
<span class="m">2</span>
<span class="m">4</span>
<span class="m">6</span>
<span class="m">8</span>
$<span class="w"> </span>sh<span class="w"> </span>./sumbit_job.sh
<span class="o">{</span><span class="m">2</span>..8..2<span class="o">}</span>
</code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>cannot support variable, such as
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="m">100</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">160</span>..250..<span class="nv">$a</span><span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$i</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="o">{</span><span class="m">160</span>..250..100<span class="o">}</span>
$<span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="m">100</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">160</span>..250..100<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$i</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="m">160</span>
</code></pre></div>
Instead, we can use <code>seq</code>. The reason is that</p>
<blockquote>
<p><a href="https://stackoverflow.com/a/6191382/">In bash, brace expansion happens before variable expansion, so this is not directly possible.</a></p>
</blockquote>
</div>
<ul>
<li>construct an array</li>
</ul>
<p>actually, it can be used to construct an array,</p>
<div class="highlight"><pre><span></span><code><span class="nv">arr</span><span class="o">=({</span><span class="m">1</span>..10..2<span class="o">})</span>
<span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$i</span>
<span class="k">done</span>
</code></pre></div>
<ul>
<li><code>seq</code></li>
</ul>
<p>alternatively, we can use <code>seq</code>,</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">50</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$i</span>
<span class="k">done</span>
</code></pre></div>
<h2 id="string">String<a class="headerlink" href="#string" title="Permanent link">&para;</a></h2>
<h3 id="quotes">Quotes<a class="headerlink" href="#quotes" title="Permanent link">&para;</a></h3>
<ol>
<li>单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；</li>
<li>单引号字串中不能出现单引号（对单引号使用转义符后也不行）。</li>
<li>双引号里可以有变量</li>
<li>双引号里可以出现转义字符</li>
</ol>
<p>虽然没法给单引号里面的双引号赋值，但可以通过两个单引号连起来。比如</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nv">STR</span><span class="o">=</span><span class="s2">&quot;STR&quot;</span><span class="p">;</span><span class="w"> </span>julia<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;println(&#39;</span><span class="se">\&quot;</span><span class="nv">$STR</span><span class="se">\&quot;</span><span class="s1">&#39;)&#39;</span>
STR
</code></pre></div>
<p>注意其中的双引号需要转义，否则 <code>$STR</code> 直接赋值为不带引号的 <code>STR</code>。The reason is that</p>
<blockquote>
<p>quotation marks in the shell are not word delimiters; by themselves, they don&rsquo;t terminate a word. You can go in and out of quotes, including between different types of quotes, within the same word to get the desired result
<a href="https://stackoverflow.com/questions/13799789/expansion-of-variables-inside-single-quotes-in-a-command-in-bash">source</a></p>
</blockquote>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li><a href="https://github.com/szcf-weiya/Clouds/blob/45481f4a9db3c89ffd7bfe895fc0064744a6d250/src/run.sh">bash scripts for julia</a></li>
</ul>
</div>
<h3 id="strip-first-2-characters">strip first 2 characters<a class="headerlink" href="#strip-first-2-characters" title="Permanent link">&para;</a></h3>
<p>simplest way:</p>
<div class="highlight"><pre><span></span><code><span class="si">${</span><span class="nv">string</span><span class="p">:</span><span class="nv">2</span><span class="si">}</span>
</code></pre></div>
<p>More generally, <code>${str:position:length}</code> extracts the substring started from the <code>position</code> with length <code>length</code>.</p>
<p>Some alternatives refer to <a href="https://stackoverflow.com/questions/11469989/how-can-i-strip-first-x-characters-from-string-using-sed">How can I strip first X characters from string using sed?</a>, or <a href="https://stackoverflow.com/questions/6594085/remove-first-character-of-a-string-in-bash">Remove first character of a string in Bash</a></p>
<p>a real application in my project:</p>
<div class="highlight"><pre><span></span><code><span class="nv">list</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="k">for</span><span class="w"> </span>nc<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">2</span>..10<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span>nf<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">15</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">list</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$list</span><span class="s2">,acc-</span><span class="nv">$nc</span><span class="s2">-</span><span class="nv">$nf</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="c1">#https://stackoverflow.com/questions/6594085/remove-first-character-of-a-string-in-bash</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">list</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
<span class="w">  </span><span class="k">done</span>
<span class="k">done</span>
</code></pre></div>
<h3 id="strip-from-left-or-right">strip from left or right<a class="headerlink" href="#strip-from-left-or-right" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 从左最大化匹配字符 `y`，然后截掉左边内容</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">##*y</span><span class="si">}</span>
zz
<span class="c1"># 从左匹配第一个字符 `y`</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">#*y</span><span class="si">}</span>
yzz
<span class="c1"># 从右最大化匹配字符 `y`，然后截掉右边内容</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">%%y*</span><span class="si">}</span>
xx
<span class="c1"># 从右匹配第一个字符 `y`</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">%y*</span><span class="si">}</span>
xxy
</code></pre></div>
<h3 id="remove-last-character">remove last character<a class="headerlink" href="#remove-last-character" title="Permanent link">&para;</a></h3>
<p>with <code>bash 4.2+</code>,</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">:</span><span class="k">:-</span><span class="nv">1</span><span class="si">}</span>
xxyyz
</code></pre></div>
<p>refer to <a href="https://unix.stackexchange.com/questions/144298/delete-the-last-character-of-a-string-using-string-manipulation-in-shell-script">Delete the last character of a string using string manipulation in shell script</a></p>
<h3 id="replace-character">replace character<a class="headerlink" href="#replace-character" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nv">var</span><span class="o">=</span><span class="s2">&quot;xxyyzz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">/xx/XX</span><span class="si">}</span>
XXyyzz
</code></pre></div>
<p>But this only replaces the first occurrence, for all occurrence, use double slashes, i.e., <code>${var//xx/XX}</code></p>
<p>Another application is to check whether a string is not empty, neither space, <code>[ -n "${str// /}" ]</code>, see also <a href="https://stackoverflow.com/questions/13509508/check-if-string-is-neither-empty-nor-space-in-shell-script"><img alt="🔗" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f517.svg" title=":link:" /></a></p>
<h3 id="default-value">default value<a class="headerlink" href="#default-value" title="Permanent link">&para;</a></h3>
<ul>
<li><code>${1:-foo}</code>: if parameter is unset or <strong>null</strong>, the expansion of word is substituted.</li>
<li><code>${1-foo}</code>: only substitute if parameter is unset.</li>
</ul>
<p>refer to <a href="https://stackoverflow.com/questions/9332802/how-to-write-a-bash-script-that-takes-optional-input-arguments">How to write a bash script that takes optional input arguments?</a></p>
<p>applications:</p>
<ul>
<li><a href="https://github.com/szcf-weiya/Clouds/blob/b8abfc63078ac53e817c2a3d7f3e92d44cf47f61/run_test_local.sh#L5-L9">Clouds/run_test_local.sh</a></li>
</ul>
<h2 id="array">Array<a class="headerlink" href="#array" title="Permanent link">&para;</a></h2>
<ol>
<li>在Shell中，用括号来表示数组，数组元素用“空格”符号分割开。</li>
<li>所有元素：<code>${ARRAY[@]}</code> 或者 <code>${ARRAY[*]}</code></li>
<li>数组长度：<code>${#ARRAY[@]}</code></li>
<li>从 0 编号：<code>${ARRAY[0]}</code>，类似 C 语言，与 <code>${ARRAY}</code> 返回结果相同。</li>
</ol>
<h2 id="image-link-url-label">Image Link -&gt; URL + Label<a class="headerlink" href="#image-link-url-label" title="Permanent link">&para;</a></h2>
<p>We can use </p>
<div class="highlight"><pre><span></span><code>!<span class="o">[</span>IMG_0802<span class="o">](</span>https://user-images.githubusercontent.com/13688320/72489850-733ae480-3850-11ea-8e51-15021588a7e6.jpg<span class="o">)</span>
</code></pre></div>
<p>to insert an image into the post. If there are multiple external web images with regular labels, such as <code>IMG_0XXX</code>, it might be convenient to convert the above format to</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>IMG_0802<span class="o">]</span>:<span class="w"> </span>https://user-images.githubusercontent.com/13688320/72489850-733ae480-3850-11ea-8e51-15021588a7e6.jpg
</code></pre></div>
<p>and then use the image with <code>![IMG_0802][IMG_0802]</code>. The solution is</p>
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/\!\[IMG_\([0-9]\{4\}\)\](\(.*\))/\[IMG_\1\]\: \2/g&quot;</span><span class="w"> </span>FILENAME
</code></pre></div>
<ul>
<li><code>\(\)</code> 用于匹配子串，并可以通过 <code>\1</code>, <code>\2</code> 引用</li>
<li><code>\!</code> 需要 escape</li>
<li><code>\2</code> 前面的空格不需要写成 <code>[ ]</code>，不然会直接出现 <code>[ ]</code>，而之前某次为了匹配多个空格需要写成 <code>[ ]*</code></li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://github.com/szcf-weiya/en/commit/6445be6861a2486726f5b1357cfdcbecafb95861#diff-bbd47260e02ab52e5c0ab0ad7c71bde903ea63dbf89a6e11b34915c01ba0482a">A practical example</a></p>
</div>
<h2 id="external-images-local">External Images -&gt; Local<a class="headerlink" href="#external-images-local" title="Permanent link">&para;</a></h2>
<p>人总是善变的，过了一段时间，我又想把这些 img 下载到本地文件夹。有个原因是直接使用 GitHub 的外链图片，在墙外访问都很流畅，但是疫情期间待在家，就想将这些外链图片下载到本地，然后通过本地引用图片，这样使得墙内访问更加流畅。</p>
<p>但是之前处理过的文件都删掉了，只剩下传到 GitHub 上的了，所以我首先要把文件下载到合适的位置并重命名。比如对于文件 <code>_posts/2019-12-21-quant-genetics.md</code>，只保留了 <code>https://user-images.githubusercontent.com/</code> 的链接，采用下面的脚本下载到合适的位置并重命名，</p>
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;https://user-images.&quot;</span><span class="w"> </span>_posts/2019-12-21-quant-genetics.md<span class="w"> </span><span class="p">|</span><span class="w"> </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-a<span class="w"> </span>ADDR<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${#</span><span class="nv">ADDR</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span>
<span class="w">            </span>proxychains<span class="w"> </span>wget<span class="w"> </span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[1]</span><span class="si">}</span><span class="w"> </span>-O<span class="w"> </span>images/2019-12-21-quant-genetics/<span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]:</span><span class="nv">1</span><span class="p">:</span><span class="nv">8</span><span class="si">}</span>.jpg<span class="p">;</span><span class="w"> </span>
<span class="w">        </span><span class="k">fi</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">done</span>
</code></pre></div>
<p>其中</p>
<ul>
<li><code>ADDR[0]:1:8</code> 是所谓的 <a href="https://unix.stackexchange.com/questions/9468/how-to-get-the-char-at-a-given-position-of-a-string-in-shell-script">&ldquo;Parameter Expansion&rdquo; ${parameter:offset:length}</a>，用于提取特定范围的子串</li>
<li><code>wget -O</code> 是重命名，这里顺带移动到合适的位置</li>
<li><code>proxychains</code> 则是用于科学上网</li>
<li><code>read -a ADDR</code> 表示将分割后的字符串（比如默认按照空格进行分割，或者指定 <code>IFS=</code>）放进数组 ADDR 中，详见 <code>help read</code>，而 <code>man read</code> 并没有给出参数列表。另外需要注意到数组 <code>$ADDR</code> 返回结果为 <code>${ADDR[0]}</code>.<ul>
<li>读取单行文件时，采用 <code>;</code> 而非 pipeline，比如文件 <code>text.txt</code> 有单行内容 <code>1 2 3 4</code>. 应用 <code>read -a A &lt; test.txt; echo ${A[0]}</code>，而非 <code>read -a A &lt; test.txt | echo ${A[0]}</code>，后者返回空结果。</li>
</ul>
</li>
</ul>
<h2 id="git-init-date-as-post-date">Git Init Date as Post Date<a class="headerlink" href="#git-init-date-as-post-date" title="Permanent link">&para;</a></h2>
<p>将 ESL-CN 中的手动输入的时间统一为发布的时间，详见<a href="https://github.com/szcf-weiya/ESL-CN/commit/431c8defa535b4448b8256a9639d5a633d00622d"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 11.75A.75.75 0 0 1 .75 11h5a.75.75 0 0 1 0 1.5h-5a.75.75 0 0 1-.75-.75Zm17.5 0a.75.75 0 0 1 .75-.75h5a.75.75 0 0 1 0 1.5h-5a.75.75 0 0 1-.75-.75Z"/><path d="M12 17.75a6 6 0 1 1 0-12 6 6 0 0 1 0 12Zm0-1.5a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Z"/></svg></span></a></p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>find<span class="w"> </span>.<span class="w"> </span>-regex<span class="w"> </span><span class="s2">&quot;./.*\.md&quot;</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">first</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>log<span class="w"> </span>--date<span class="o">=</span>short<span class="w"> </span>--format<span class="o">=</span>%ad<span class="w"> </span>--follow<span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$file</span><span class="w"> </span><span class="nv">$first</span>
<span class="w">    </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/^\(|*\)[ ]*时间[ ]*|[^|]*\(|*\)[ ]*</span>$<span class="s2">/\1 发布 | </span><span class="nv">$first</span><span class="s2"> \2/g&quot;</span><span class="w"> </span><span class="nv">$file</span>
<span class="k">done</span>
</code></pre></div>
<p>其中 </p>
<ul>
<li><code>$first</code> 提取最初 commit 的时间</li>
<li><code>\1</code> 和 <code>\2</code> 是为了处理有些表格写的是 <code>|--|--|</code>，而有些用的是 <code>--|--</code>，如果混用，则列会发生偏移，所以自适应保留原先的格式</li>
<li><code>|[^|]*</code> 是为了匹配第二个除表格符号 <code>|</code> 的内容，不要直接用 <code>|.*</code>，这样也会匹配最后的 <code>|</code>，从而 <code>\2</code> 匹配不到</li>
<li>定界符<code>^$</code> 为了防止匹配正文中的 <code>时间</code></li>
</ul>
<h2 id="rename-in-batch">Rename in Batch<a class="headerlink" href="#rename-in-batch" title="Permanent link">&para;</a></h2>
<p>有时候下载文件时网站并没有区分同名文件，下载到本地后会出现 <code>A.zip</code> 与 <code>A (1).zip</code> 的情况，但这两个并不是相同的文件，所以避免以后误删，决定重命名。不过此类文件有好几个，批量处理代码为</p>
<div class="highlight"><pre><span></span><code>ls<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;(1)&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-a<span class="w"> </span>ADDR<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2"> (1).zip&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2">_SOMETHING.zip&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<h2 id="ip">统计访问日志里每个 ip 访问次数<a class="headerlink" href="#ip" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
cat<span class="w"> </span>access.log<span class="w"> </span><span class="p">|</span>sed<span class="w"> </span>-rn<span class="w"> </span><span class="s1">&#39;/28\/Jan\/2015/p&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>a.txt
cat<span class="w"> </span>a.txt<span class="w"> </span><span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="p">|</span>sort<span class="w"> </span><span class="p">|</span>uniq<span class="w"> </span>&gt;<span class="w"> </span>ipnum.txt
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>cat<span class="w"> </span>ipnum.txt<span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">iptj</span><span class="o">=</span><span class="sb">`</span>cat<span class="w">  </span>access.log<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="p">|</span>wc<span class="w"> </span>-l<span class="sb">`</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ip地址&quot;</span><span class="nv">$i</span><span class="s2">&quot;在2015-01-28日全天(24小时)累计成功请求&quot;</span><span class="nv">$iptj</span><span class="s2">&quot;次，平均每分钟请求次数为：&quot;</span><span class="k">$((</span><span class="nv">$iptj</span><span class="o">/</span><span class="m">1440</span><span class="k">))</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>result.txt
<span class="k">done</span>
</code></pre></div>
<p>Refer to</p>
<ul>
<li><a href="https://www.cnblogs.com/paul8339/p/6207182.html">用shell统计访问日志里每个ip访问次数</a></li>
<li><a href="https://linux.cn/article-3945-1.html">技术|如何在Linux中使用awk命令</a></li>
<li><a href="https://stackoverflow.com/questions/8629330/unix-count-of-columns-in-file">unix - count of columns in file</a></li>
<li><a href="http://www.pement.org/awk/awk1line.txt">HANDY ONE-LINE SCRIPTS FOR AWK</a></li>
<li><a href="https://www.tecmint.com/learn-use-awk-special-patterns-begin-and-end/">Learn How to Use Awk Special Patterns ‘BEGIN and END’ – Part 9</a></li>
<li><a href="https://stackoverflow.com/questions/20752043/print-line-numbers-starting-at-zero-using-awk">Print line numbers starting at zero using awk</a></li>
</ul>
<h2 id="split-string-while-reading-files">split string while reading files<a class="headerlink" href="#split-string-while-reading-files" title="Permanent link">&para;</a></h2>
<p>specify <code>IFS=</code>.</p>
<ol>
<li><a href="https://stackoverflow.com/questions/19719827/how-to-split-a-tab-delimited-string-in-bash-script-without-collapsing-blanks">How to split a tab-delimited string in bash script WITHOUT collapsing blanks?</a></li>
<li><a href="https://stackoverflow.com/questions/27500692/split-string-in-shell-script-while-reading-from-file">Split String in shell script while reading from file</a></li>
<li><a href="https://stackoverflow.com/questions/10929453/read-a-file-line-by-line-assigning-the-value-to-a-variable">Read a file line by line assigning the value to a variable</a></li>
</ol>
<h2 id="distribute-jobs-into-queues">distribute jobs into queues<a class="headerlink" href="#distribute-jobs-into-queues" title="Permanent link">&para;</a></h2>
<p>since different queues has different quota, try to assign the job into available nodes.</p>
<div class="highlight"><pre><span></span><code><span class="nv">queue</span><span class="o">=(</span>bigmem<span class="w"> </span>large<span class="w"> </span>batch<span class="o">)</span>
<span class="nv">queues</span><span class="o">=()</span>
<span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;<span class="m">12</span><span class="p">;</span>i++<span class="o">))</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">queues</span><span class="o">+=(</span><span class="si">${</span><span class="nv">queue</span><span class="p">[0]</span><span class="si">}</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;<span class="m">20</span><span class="p">;</span>i++<span class="o">))</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">queues</span><span class="o">+=(</span><span class="si">${</span><span class="nv">queue</span><span class="p">[1]</span><span class="si">}</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;<span class="m">15</span><span class="p">;</span>i++<span class="o">))</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">queues</span><span class="o">+=(</span><span class="si">${</span><span class="nv">queue</span><span class="p">[2]</span><span class="si">}</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="p">;</span>
</code></pre></div>
<p>where <code>((i++))</code> increases <code>i</code> by 1, and similar syntax can be</p>
<div class="highlight"><pre><span></span><code><span class="nv">i</span><span class="o">=</span><span class="m">0</span>
<span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span>
<span class="c1"># or</span>
<span class="nv">i</span><span class="o">=</span><span class="k">$((</span><span class="nv">$i</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
<span class="c1"># or</span>
<span class="o">((</span><span class="nv">i</span><span class="o">+=</span><span class="m">1</span><span class="o">))</span>
<span class="c1"># or</span>
<span class="o">((</span>i++<span class="o">))</span>
</code></pre></div>
<p><code>((...))</code> also support general arithmetic operations, such as</p>
<div class="highlight"><pre><span></span><code><span class="nv">a</span><span class="o">=</span><span class="m">30</span>
<span class="nv">b</span><span class="o">=</span><span class="m">10</span>
<span class="nb">echo</span><span class="w"> </span><span class="k">$((</span><span class="nv">a</span><span class="o">+=</span>b<span class="k">))</span>
<span class="nb">echo</span><span class="w"> </span><span class="k">$((</span>a*<span class="o">=</span>b<span class="k">))</span>
<span class="nb">echo</span><span class="w"> </span><span class="k">$((</span>a-<span class="o">=</span>b<span class="k">))</span>
<span class="nb">echo</span><span class="w"> </span><span class="k">$((</span>a/<span class="o">=</span>b<span class="k">))</span>
<span class="nb">echo</span><span class="w"> </span><span class="k">$((</span>a/<span class="o">=</span>b<span class="k">))</span>
<span class="c1"># 40</span>
<span class="c1"># 400</span>
<span class="c1"># 390</span>
<span class="c1"># 39</span>
<span class="c1"># 3</span>
</code></pre></div>
<p>but note that it does not allow float number, as the last equation, which should be <code>39/10=3.9</code></p>
<p>the float calculation can take the advantage of other programs, such as</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Note that `BEGIN` cannot be removed, otherwise it is waiting for input file</span>
<span class="c1"># see the BEGIN and END pattern of awk</span>
$<span class="w"> </span>awk<span class="w"> </span><span class="s2">&quot;BEGIN {print 39/10}&quot;</span>
<span class="m">3</span>.9
$<span class="w"> </span>bc<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;39/10&quot;</span>
<span class="m">3</span>
$<span class="w"> </span>bc<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;scale=2; 39/10&quot;</span>
<span class="m">3</span>.90
</code></pre></div>
<p>refer to</p>
<ul>
<li><a href="https://stackoverflow.com/questions/1951506/add-a-new-element-to-an-array-without-specifying-the-index-in-bash">Add a new element to an array without specifying the index in Bash</a></li>
<li><a href="https://stackoverflow.com/questions/29205213/repeat-an-element-n-number-of-times-in-an-array">Repeat an element n number of times in an array</a></li>
<li><a href="http://tldp.org/LDP/abs/html/dblparens.html">The Double-Parentheses Construct</a></li>
<li><a href="https://stackoverflow.com/questions/21035121/increment-variable-value-by-1-shell-programming">Increment variable value by 1 ( shell programming)</a></li>
<li><a href="http://www.runoob.com/linux/linux-shell-array.html">Shell 数组</a></li>
<li><a href="https://unix.stackexchange.com/questions/40786/how-to-do-integer-float-calculations-in-bash-or-other-languages-frameworks">How to do integer &amp; float calculations, in bash or other languages/frameworks?</a></li>
</ul>
<h2 id="command-line-arguments">Command line arguments<a class="headerlink" href="#command-line-arguments" title="Permanent link">&para;</a></h2>
<p>refer to <a href="https://www.devdungeon.com/content/taking-command-line-arguments-bash">Taking Command Line Arguments in Bash</a></p>
<h2 id="join-elements-of-an-array-in-bash">join elements of an array in Bash<a class="headerlink" href="#join-elements-of-an-array-in-bash" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nv">arr</span><span class="o">=(</span>a<span class="w"> </span>b<span class="w"> </span>c<span class="o">)</span>
<span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s\n&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nv">IFS</span><span class="o">=</span>,<span class="p">;</span><span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">arr</span><span class="p">[*]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="c1"># a,b,c</span>
</code></pre></div>
<p>where <code>*</code> or <code>@</code> return all elements of such array.</p>
<p>refer to <a href="https://stackoverflow.com/questions/1527049/how-can-i-join-elements-of-an-array-in-bash">How can I join elements of an array in Bash?</a></p>
<h3 id="a-more-complex-way">A more complex way<a class="headerlink" href="#a-more-complex-way" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nv">list</span><span class="o">=</span>
<span class="k">for</span><span class="w"> </span>nc<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">2</span>..10<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span>nf<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">15</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$list</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span>
<span class="w">    </span><span class="k">then</span>
<span class="w">        </span><span class="nv">list</span><span class="o">=</span>acc-<span class="nv">$nc</span>-<span class="nv">$nf</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nv">list</span><span class="o">=</span><span class="nv">$list</span>,acc-<span class="nv">$nc</span>-<span class="nv">$nf</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">  </span><span class="k">done</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$list</span>
</code></pre></div>
<h2 id="globbing-for-ls-vs-regular-expression-for-find">globbing for <code>ls</code> vs regular expression for <code>find</code><a class="headerlink" href="#globbing-for-ls-vs-regular-expression-for-find" title="Permanent link">&para;</a></h2>
<p>Support we want to get <code>abc2.txt</code> as stated in <a href="https://unix.stackexchange.com/questions/44754/listing-with-ls-and-regular-expression">Listing with <code>ls</code> and regular expression
</a>,</p>
<p><code>ls</code> does not support regular expressions, but it can work with globbing, or filename expressions.</p>
<div class="highlight"><pre><span></span><code>ls<span class="w"> </span>*<span class="o">[</span>!0-9<span class="o">][</span><span class="m">0</span>-9<span class="o">]</span>.txt
</code></pre></div>
<p>where <code>!</code> is complement.</p>
<p>Alternatively, we can use <code>find -regex</code>,</p>
<div class="highlight"><pre><span></span><code>find<span class="w"> </span>.<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-regex<span class="w"> </span><span class="s1">&#39;\./.*[^0-9][0-9]\.txt&#39;</span>
</code></pre></div>
<p>where</p>
<ul>
<li><code>-maxdepth 1</code> disables recursive, and only to find files in the current directory</li>
</ul>
<p>We also can add <code>-exec ls</code> to get the output of <code>ls</code>, and change the regex type by <code>-regextype egrep</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Regular Expressions</p>
<ul>
<li><a href="https://www.antipope.org/charlie/old/attic/tkperl/ptk-3.html">Regular Expressions in Perl</a></li>
</ul>
</div>
<h2 id="multiple-ifs">Multiple <code>IFS</code><a class="headerlink" href="#multiple-ifs" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-a<span class="w"> </span>ADDR<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-a<span class="w"> </span>Line<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="nv">$ADDR</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">Line</span><span class="p">[0]</span><span class="si">}</span><span class="p">;</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>grep<span class="w"> </span>-nE<span class="w"> </span><span class="s2">&quot;finished&quot;</span><span class="w"> </span>slurm-37985.out<span class="o">)</span>
</code></pre></div>
<p>will also output the numbers of the finished line.</p>
<ul>
<li><code>&lt;()</code> is called <a href="https://superuser.com/questions/1059781/what-exactly-is-in-bash-and-in-zsh">process substitution</a>, see also <a href="https://stackoverflow.com/questions/31546680/how-to-pipe-grep-output-to-paste-input">pipe grep output to paste input</a></li>
<li><code>&lt;&lt;&lt;</code> is known as <code>here string</code>, and <a href="https://askubuntu.com/questions/678915/whats-the-difference-between-and-in-bash">different from <code>&lt;&lt;</code>, <code>&lt;</code></a></li>
</ul>
<p>refer to <a href="https://stackoverflow.com/questions/23356779/how-can-i-store-the-find-command-results-as-an-array-in-bash">How can I store the “find” command results as an array in Bash</a></p>
<p>my working case:</p>
<div class="highlight"><pre><span></span><code><span class="nv">files</span><span class="o">=()</span>
<span class="nv">start_time</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;2019-09-21T14:11:16&quot;</span><span class="w"> </span>+<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="nv">end_time</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;2019-09-22T20:07:00&quot;</span><span class="w"> </span>+<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w">  </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>-d<span class="w"> </span><span class="s1">$&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-ra<span class="w"> </span>ADDR<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$REPLY</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="nv">timestamp</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[2]</span><span class="si">}</span><span class="w"> </span>+<span class="s1">&#39;%s&#39;</span><span class="k">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$timestamp</span><span class="w"> </span>-ge<span class="w"> </span><span class="nv">$start_time</span><span class="w"> </span>-a<span class="w"> </span><span class="nv">$timestamp</span><span class="w"> </span>-lt<span class="w"> </span><span class="nv">$end_time</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">curr_folder</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[1]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[2]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">files</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[0]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[1]</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ADDR</span><span class="p">[2]</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="w">    </span>qsub<span class="w"> </span>-v<span class="w"> </span><span class="nv">folder</span><span class="o">=</span><span class="si">${</span><span class="nv">curr_folder</span><span class="si">}</span><span class="w"> </span>revisit_sil_parallel.job
<span class="w">  </span><span class="k">fi</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span>.<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-regex<span class="w"> </span><span class="s2">&quot;\./oracle_setting_2019-09-.*recall\.pdf&quot;</span><span class="w"> </span>-print0<span class="o">)</span>
</code></pre></div>
<h2 id="_1">链接自动推送<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>find<span class="w"> </span>-regex<span class="w"> </span><span class="s2">&quot;\./.*\.html&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;s#\./#https://esl.hohoweiya.xyz/#p&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>../urls.txt
</code></pre></div>
<h2 id="get-path-of-the-current-script">Get path of the current script<a class="headerlink" href="#get-path-of-the-current-script" title="Permanent link">&para;</a></h2>
<p>we can get the path of the current script via</p>
<div class="highlight"><pre><span></span><code><span class="nv">CURDIR</span><span class="o">=</span><span class="sb">`</span>/bin/pwd<span class="sb">`</span>
<span class="nv">BASEDIR</span><span class="o">=</span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$0</span><span class="k">)</span>
<span class="nv">ABSPATH</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="nv">$0</span><span class="k">)</span>
<span class="nv">ABSDIR</span><span class="o">=</span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$ABSPATH</span><span class="k">)</span>
</code></pre></div>
<p>refer to <a href="https://gist.github.com/darrenderidder/974638">darrenderidder/bashpath.sh</a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>dirname</code> is one of the functions for filenames, here are many other functions, such as</p>
<ul>
<li><code>dir</code></li>
<li><code>realpath</code></li>
<li><code>abspath</code></li>
</ul>
<p>see <a href="https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html">8.3 Functions for File Names</a> for more details.</p>
</div>
<p>where <code>dirname</code>, together with <code>basename</code> aims to extract the filename and path, such as</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>basename<span class="w"> </span>/dir1/dir2/file.txt
file.txt
$<span class="w"> </span>dirname<span class="w"> </span>/dir1/dir2/file.txt
/dir1/dir2
$<span class="w"> </span>dirname<span class="w"> </span><span class="sb">`</span>dirname<span class="w"> </span>/dir1/dir2/file.txt<span class="sb">`</span>
/dir1
</code></pre></div>
<p>but note that <code>dirname</code> would also return the parent directory of a directory, as shown in the last case.</p>
<p>Alternatively, we can use <code>${}</code> to extract the path,</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 从左开始最大化匹配到字符 `/`，然后截掉左边内容（包括`/`)</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">##*/</span><span class="si">}</span>
file.txt
<span class="c1"># 文件后缀</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">##*.</span><span class="si">}</span>
txt
<span class="c1"># 两个文件后缀（从左开始第一次匹配到字符 `.`，然后截掉左边内容（包括`/`)</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.tar.gz<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">#*.</span><span class="si">}</span>
tar.gz
<span class="c1"># 从右开始第一次匹配到字符 `/`</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">%/*</span><span class="si">}</span>
/dir1/dir2
<span class="c1"># 从右最大化匹配到字符 `.`</span>
$<span class="w"> </span><span class="nv">var</span><span class="o">=</span>/dir1/dir2/file.tar.gz<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">var</span><span class="p">%%.*</span><span class="si">}</span>
/dir1/dir2/file
</code></pre></div>
<p>其中 <code>*</code> 表示要删除的内容，另外还需要一个字符表示截断点，注意到与 <code>#</code> 使用时截断字符在右边，而与 <code>%</code> 使用时截断字符在左边。</p>
<p>参考 <a href="http://blog.csdn.net/universe_hao/article/details/52640321">shell 提取文件名和目录名</a></p>
<h2 id="if-statement"><code>if</code> statement<a class="headerlink" href="#if-statement" title="Permanent link">&para;</a></h2>
<h3 id="devnull"><code>&amp;&gt; /dev/null</code><a class="headerlink" href="#devnull" title="Permanent link">&para;</a></h3>
<p>We can add <code>&amp;&gt; /dev/null</code> to hidden the output information in the condition of <code>if</code>. For example, check if user exists,</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># refer to https://blog.51cto.com/64314491/1629175</span>
<span class="k">if</span><span class="w"> </span>id<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2"> exists&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2"> is not exists&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<p>note that for an existed user, the exit code is 0, while for a non-existed user, the exit code is non-zero, so the above command seems counter-intuitive.</p>
<div class="highlight"><pre><span></span><code>~$<span class="w"> </span>id<span class="w"> </span>weiya<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>
~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$?</span>
<span class="m">0</span>
~$<span class="w"> </span>id<span class="w"> </span>weiya2<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>
~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$?</span>
<span class="m">1</span>
</code></pre></div>
<p>another similar form can be found in <a href="https://unix.stackexchange.com/questions/34491/dev-null-21-in-if-statement"><code>&gt;/dev/null 2&gt;&amp;1</code> in <code>if</code> statement</a></p>
<p>Another example: test if a file has an empty line,</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="k">if</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^</span>$<span class="s2">&quot;</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;there are `grep &quot;</span>^$<span class="s2">&quot; </span><span class="nv">$1</span><span class="s2"> | wc -l` empty lines&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;no empty lines&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<h3 id="logical-operation">logical operation<a class="headerlink" href="#logical-operation" title="Permanent link">&para;</a></h3>
<p>判断 Linux 发行版所属主流发行系列，另见 <a href="../Linux/#linux-distributions">Linux Distributions</a></p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Fedora<span class="w"> </span>-o<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Gentoo<span class="w"> </span>-o<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Redhat<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Redhat Series.&quot;</span>
<span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Suse<span class="w"> </span>-o<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Opensuse<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Suse Series.&quot;</span>
<span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Ubuntu<span class="w"> </span>-o<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Mint<span class="w"> </span>-o<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>Debian<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Debian Series.&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The </span><span class="nv">$1</span><span class="s2"> is Unknown Series.&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<h3 id="check-if-uid-equals-gid">check if uid equals gid<a class="headerlink" href="#check-if-uid-equals-gid" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="k">if</span><span class="w"> </span>id<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="c1"># not -G</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="sb">`</span>id<span class="w"> </span>-u<span class="w"> </span><span class="nv">$1</span><span class="sb">`</span><span class="w"> </span>-eq<span class="w"> </span><span class="sb">`</span>id<span class="w"> </span>-g<span class="w"> </span><span class="nv">$1</span><span class="sb">`</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;gid = uid&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;gid not uid&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;not exist&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<p>note that use <code>-g</code> instead of <code>-G</code>, where the latter one would print all group ids.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>get the id of specific user, <code>id -u weiya</code>, or get the corresponding username by the name, <code>id -un 1000</code>.</p>
</div>
<h3 id="sum-parameters">sum parameters<a class="headerlink" href="#sum-parameters" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">sum</span><span class="o">=</span><span class="m">0</span>
<span class="k">for</span><span class="w"> </span>I<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">$#</span><span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">sum</span><span class="o">=</span><span class="k">$((</span><span class="nv">$sum</span><span class="o">+</span><span class="nv">$I</span><span class="k">))</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$sum</span>
</code></pre></div>
<p>alternatively,</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># refer to https://blog.51cto.com/64314491/1629175</span>
<span class="nv">sum</span><span class="o">=</span><span class="m">0</span>
<span class="k">for</span><span class="w"> </span>I<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">$#</span><span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">sum</span><span class="o">=</span><span class="k">$((</span><span class="nv">$sum</span><span class="o">+</span><span class="nv">$1</span><span class="k">))</span>
<span class="w">    </span><span class="nb">shift</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$sum</span>
</code></pre></div>
<p>where <code>shift</code> alternates the parameters such that <code>$1</code> becomes the next parameter.</p>
<p>The results are</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>./sum-paras.sh<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span>
<span class="m">10</span>
$<span class="w"> </span>./sum-paras2.sh<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span>
<span class="m">10</span>
</code></pre></div>
<h3 id="test-string">test string<a class="headerlink" href="#test-string" title="Permanent link">&para;</a></h3>
<ul>
<li><code>=~</code>: 判断左边的字符串是否能被右边的模式所匹配</li>
<li><code>-z $A</code>: 字符串长度是否为 zero（为空则为真，否则为假）</li>
<li><code>-n $A</code>: 字符串长度是否为 nonzero（为空则为假，否则为真）</li>
<li>more details refer to <code>man test</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">Shell</span><span class="o">=</span><span class="sb">`</span>grep<span class="w"> </span><span class="s2">&quot;^</span><span class="nv">$1</span><span class="s2">:&quot;</span><span class="w"> </span>/etc/passwd<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d:<span class="w"> </span>-f7<span class="sb">`</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$Shell</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No such user&quot;</span>
<span class="k">fi</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$Shell</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>sh$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Login user&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Not a login user&quot;</span>
<span class="k">fi</span>
</code></pre></div>
<h3 id="test-file">test file<a class="headerlink" href="#test-file" title="Permanent link">&para;</a></h3>
<p>格式为 <code>[ EXPR FILE ]</code>，其中常见 <code>EXPR</code> 有</p>
<ul>
<li><code>-f</code>: 测试其是否为普通文件，即 <code>ls -l</code> 时文件类型为 <code>-</code> 的文件</li>
<li><code>-d</code>: 测试其是否为目录文件，即 <code>ls -l</code> 时文件类型为 <code>d</code> 的文件</li>
<li><code>-e</code>: 测试文件是否存在；存在为真，否则为假</li>
<li><code>-r</code>: 测试文件对当前用户来说是否可读</li>
<li><code>-w</code>: 测试文件对当前用户来说是否可写</li>
<li><code>-x</code>: 测试文件对当前用户来说是否可执行</li>
<li><code>-s</code>: 测试文件大小是否不空，不空则真，空则假</li>
</ul>
<p>例子</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span>/tmp/test<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>mkdir<span class="w"> </span>/tmp/test
<span class="k">fi</span>
</code></pre></div>
<p>refer to <a href="https://blog.51cto.com/64314491/1629175">bash条件判断之if语句</a></p>
<h2 id="aka-test-vs"><code>[</code> (aka <code>test</code>) vs <code>[[</code><a class="headerlink" href="#aka-test-vs" title="Permanent link">&para;</a></h2>
<p>Refer to [What is the difference between test, [ and [<a href="http://mywiki.wooledge.org/BashFAQ/031"> ?</a></p>
<p>Both are used to evaluate expressions, but</p>
<ul>
<li><code>[[</code> works only in Korn shell, Bash, Zsh, and recent versions of Yash and busybox <code>sh</code></li>
<li><code>[</code> is POSIX utilities (generally builtin)</li>
</ul>
<p><img alt="" src="test.png" /></p>
<p>But there are some differences:</p>
<ul>
<li>no word splitting or glob expansion will be done for <code>[[</code>, i.e., many arguments need not be quoted, while <code>[</code> usually should be quoted</li>
<li>parentheses in <code>[[</code> do not need to be escaped</li>
</ul>
<p>also see</p>
<ul>
<li><a href="https://unix.stackexchange.com/questions/99185/what-do-square-brackets-mean-without-the-if-on-the-left">What do square brackets mean without the “if” on the left?</a></li>
<li><a href="https://stackoverflow.com/questions/669452/is-double-square-brackets-preferable-over-single-square-brackets-in-ba">Is double square brackets preferable over single square brackets in Bash?</a></li>
</ul>
<h3 id="_2"><code>$[</code><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>Refer to <a href="https://unix.stackexchange.com/questions/209833/what-does-a-dollar-sign-followed-by-a-square-bracket-mean-in-bash">What does a dollar sign followed by a square bracket mean in bash?</a></p>
<p>With <code>$</code>, <code>[</code> is also can be used for arithmetic expansion, such as</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>$<span class="o">[</span><span class="w"> </span><span class="nv">$RANDOM</span><span class="w"> </span>%<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">]</span>
<span class="m">0</span><span class="w"> </span><span class="c1"># 1</span>
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>$<span class="o">[</span><span class="w"> </span><span class="m">1</span>+2<span class="w"> </span><span class="o">]</span>
<span class="m">3</span>
</code></pre></div>
<p>and actually <code>$[</code> syntax is an early syntax that was deprecated in favor of <code>$((</code>, although it&rsquo;s not completely removed yet.</p>
<h3 id="vs-vs-eq"><code>=</code> vs <code>==</code> vs <code>-eq</code><a class="headerlink" href="#vs-vs-eq" title="Permanent link">&para;</a></h3>
<p>from the above discussion:</p>
<ul>
<li><code>==</code> is a bash-ism</li>
<li><code>=</code> is POSIX</li>
</ul>
<p>In bash the two are equivalent, but in plain sh <code>=</code> is the only one guaranteed to work. And these two are for string comparisons, while <code>-eq</code> is for numerical ones.</p>
<p>refer to <a href="https://stackoverflow.com/questions/20449543/shell-equality-operators-eq">Shell equality operators (=, ==, -eq)</a></p>
<h2 id="grep-keep-the-first-line-use-sed-instead">grep keep the first line (use <code>sed</code> instead)<a class="headerlink" href="#grep-keep-the-first-line-use-sed-instead" title="Permanent link">&para;</a></h2>
<p>Refer to <a href="https://stackoverflow.com/questions/12920317/include-header-in-the-grep-result">Include header in the &lsquo;grep&rsquo; result</a></p>
<p>I am using</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sinfo<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;%P %N %C %G&quot;</span><span class="w"> </span>-N<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>gpu
</code></pre></div>
<p>to get the GPU status of the nodes on the cluster, but the header cannot be kept, then I tried</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sinfo<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;%P %N %C %G&quot;</span><span class="w"> </span>-N<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>head<span class="w"> </span>-1<span class="p">;</span><span class="w"> </span>grep<span class="w"> </span>gpu<span class="p">;</span><span class="w"> </span><span class="o">}</span>
</code></pre></div>
<p>but it only shows the header</p>
<p>Next I got the excellent solution via <code>sed</code>,</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sinfo<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;%P %N %C %G&quot;</span><span class="w"> </span>-N<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;1p;/gpu/p&quot;</span>
</code></pre></div>
<p>and it can hide the highlighter of <code>gpu</code>.</p>
<h2 id="compare-two-blocks-in-a-txt-file">compare two blocks in a txt file<a class="headerlink" href="#compare-two-blocks-in-a-txt-file" title="Permanent link">&para;</a></h2>
<p>for example, compare L82-95 with L108-123,</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>diff<span class="w"> </span>&lt;<span class="o">(</span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;82,95p&quot;</span><span class="w"> </span>measure.jl<span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;108,123p&quot;</span><span class="w"> </span>measure.jl<span class="o">)</span>
</code></pre></div>
<h2 id="as-trycatch"><code>||</code> as <code>try...catch</code><a class="headerlink" href="#as-trycatch" title="Permanent link">&para;</a></h2>
<p>No <code>try...catch</code> in bash script, but <code>command1 || command2</code> can achieve similar functionality, if <code>command1</code> fails then <code>command2</code> runs.</p>
<p>An application is to create a new tmux session if there is no such a tmux session,</p>
<div class="highlight"><pre><span></span><code>t<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>tmux<span class="w"> </span>a<span class="w"> </span>-t<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>tmux<span class="w"> </span>new<span class="w"> </span>-s<span class="w"> </span><span class="nv">$1</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
</code></pre></div>
<p>refer to <a href="https://stackoverflow.com/questions/22009364/is-there-a-try-catch-command-in-bash">Is there a TRY CATCH command in Bash</a></p>
<h2 id="replace-a-multiple-line-string">Replace a multiple line string<a class="headerlink" href="#replace-a-multiple-line-string" title="Permanent link">&para;</a></h2>
<!--
![](https://img.shields.io/badge/-sed-brightgreen) ![](https://img.shields.io/badge/-perl-orange)
-->

<p><code>sed</code> is powerful for replace in one-line, but it would be much more complicated for multiple line string. </p>
<p>An alternative is to use <code>perl</code>,</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;###BEGIN-EXCLUDE\nwww\n###END-EXCLUDE&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>perl<span class="w"> </span>-0777<span class="w"> </span>-pe<span class="w"> </span><span class="s2">&quot;s/###BEGIN-EXCLUDE(.*?)###END-EXCLUDE/xxx/igs&quot;</span>
xxx
</code></pre></div>
<p>where</p>
<ul>
<li><code>-0777</code> causes Perl to slurp files whole, see <a href="https://perldoc.perl.org/perlrun">-0[octal/hexadecimal]</a> for more details</li>
<li><code>-e commandline</code></li>
<li><code>-p</code>: my understanding is something for printing, but the <a href="https://perldoc.perl.org/perlrun">official document</a> explain more </li>
</ul>
<p>For a file to be edited in-place, we add <code>-i</code>,</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>perl<span class="w"> </span>-0777<span class="w"> </span>-i<span class="w"> </span>-pe<span class="w"> </span><span class="s2">&quot;s/###BEGIN-EXCLUDE(.*?)###END-EXCLUDE//igs&quot;</span><span class="w"> </span>test.txt
</code></pre></div>
<p>if we supply an extension such as <code>-i'.orig'</code>, then the old file would be backed up to <code>test.txt.orig</code>.</p>
<p>Refer to <a href="https://unix.stackexchange.com/questions/26284/how-can-i-use-sed-to-replace-a-multi-line-string">How can I use sed to replace a multi-line string?</a></p>
<p>Moreover, <code>.*?</code> is a non-greedy match, comparing to <code>.*</code>. </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;s12tAs34t&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>perl<span class="w"> </span>-pe<span class="w"> </span><span class="s2">&quot;s/s(.*?)t/xx/igs&quot;</span>
xxAxx
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;s12tAs34t&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>perl<span class="w"> </span>-pe<span class="w"> </span><span class="s2">&quot;s/s(.*)t/xx/igs&quot;</span>
xx
</code></pre></div>
<p>Refer to <a href="https://docstore.mik.ua/orelly/perl/cookbook/ch06_16.htm">6.15. Greedy and Non-Greedy Matches docstore.mik.ua/orelly/perl/cookbook/ch06_16.htm</a> for details.</p>
<p>By default, <code>grep</code> performs greedy match, adding option <code>-P</code> would enable Perl&rsquo;s non-greedy match.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/13688320/119338519-adc55480-bcc2-11eb-9fac-bb32d2b9c72d.png" /></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>An real application: <a href="https://github.com/szcf-weiya/Cell-Video/blob/67fef1b7737e97631aa9568b000a8c61ef1590f4/report/update_bib.sh#L21">update_bib.sh</a></p>
</div>
<p>Refer to <a href="https://stackoverflow.com/questions/3027518/how-to-do-a-non-greedy-match-in-grep/3027524">How to do a non-greedy match in grep?</a></p>
<h2 id="cut-lines-from-large-file">Cut Lines from Large File<a class="headerlink" href="#cut-lines-from-large-file" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">TL; DR</p>
<ul>
<li>the most efficient is <code>tail -n+ | head</code> (or <code>head | tail</code>)</li>
<li>the exit option <code>q</code> for <code>sed</code>, <code>exit</code> for <code>awk</code> and <code>perl</code> can speed up.</li>
</ul>
</div>
<p>prepare the follow text file to compare the processing speed of several common methods,</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nv">l1</span><span class="o">=</span><span class="m">1000000</span>
$<span class="w"> </span><span class="nv">l2</span><span class="o">=</span><span class="m">1000050</span>
$<span class="w"> </span><span class="nv">l</span><span class="o">=</span><span class="m">100000000</span>

$<span class="w"> </span>seq<span class="w"> </span>1e8<span class="w"> </span>&gt;<span class="w"> </span>test.txt
</code></pre></div>
<ul>
<li><code>head + tail</code></li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>tail<span class="w"> </span>-n+<span class="nv">$l1</span><span class="w"> </span>test.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="k">$((</span><span class="nv">$l2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">$l1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m0.033s
user<span class="w">    </span>0m0.019s
sys<span class="w"> </span>0m0.000s

$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="nv">$l2</span><span class="w"> </span>test.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="k">$((</span><span class="nv">$l2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">$l1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m0.014s
user<span class="w">    </span>0m0.019s
sys<span class="w"> </span>0m0.007s

$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="k">$((</span><span class="nv">$l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">$l1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span><span class="w"> </span>test.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="k">$((</span><span class="nv">$l2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">$l1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m25.930s
user<span class="w">    </span>0m1.467s
sys<span class="w"> </span>0m1.807s
</code></pre></div>
<p>note that <code>tail -n+</code> is much powerful than <code>tail -n</code>, it seems like the former one just move the cursor to the specific line, while the latter need to load/count from the last line (my guess). Refer to <a href="https://unix.stackexchange.com/questions/47407/cat-line-x-to-line-y-on-a-huge-file/">cat line X to line Y on a huge file</a></p>
<p><code>sed</code>/<code>awk</code>/<code>perl</code> solutions read the whole file and since this is about huge files, they&rsquo;re not very efficient. But they can be faster via <code>exit</code> or <code>quit</code> after the last line in the specified range (refer to <a href="https://unix.stackexchange.com/a/194662">What&rsquo;s the best way to take a segment out of a text file?</a>):</p>
<ul>
<li><code>sed</code></li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2">,</span><span class="nv">$l2</span><span class="s2"> p&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m4.621s
user<span class="w">    </span>0m4.253s
sys<span class="w"> </span>0m0.336s

$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2">,</span><span class="nv">$l2</span><span class="s2"> p; </span><span class="nv">$l2</span><span class="s2"> q&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m0.054s
user<span class="w">    </span>0m0.047s
sys<span class="w"> </span>0m0.008s
</code></pre></div>
<ul>
<li><code>awk</code></li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>awk<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2"> &lt;= NR &amp;&amp; NR &lt;= </span><span class="nv">$l2</span><span class="s2">&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m15.294s
user<span class="w">    </span>0m15.046s
sys<span class="w"> </span>0m0.220s

$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>awk<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2"> &lt;= NR &amp;&amp; NR &lt;= </span><span class="nv">$l2</span><span class="s2">; NR&gt;</span><span class="nv">$l2</span><span class="s2">{exit}&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m0.158s
user<span class="w">    </span>0m0.158s
sys<span class="w"> </span>0m0.001s
</code></pre></div>
<ul>
<li><code>perl</code></li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>perl<span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;print if </span><span class="si">${</span><span class="nv">l1</span><span class="si">}</span><span class="s2">..</span><span class="si">${</span><span class="nv">l2</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m10.708s
user<span class="w">    </span>0m10.498s
sys<span class="w"> </span>0m0.200s

$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>perl<span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;print if </span>$<span class="s2">. &gt;= </span><span class="si">${</span><span class="nv">l1</span><span class="si">}</span><span class="s2">; exit if </span>$<span class="s2">. &gt; </span><span class="si">${</span><span class="nv">l2</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m0.203s
user<span class="w">    </span>0m0.203s
sys<span class="w"> </span>0m0.000s
</code></pre></div>
<ul>
<li>others</li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>ed<span class="w"> </span>-s<span class="w"> </span>test.txt<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2">, </span><span class="nv">$l2</span><span class="s2"> p&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span>

real<span class="w">    </span>0m43.132s
user<span class="w">    </span>0m6.234s
sys<span class="w"> </span>0m3.637s
</code></pre></div>
<h2 id="delete-lines-in-large-file">Delete Lines in Large File<a class="headerlink" href="#delete-lines-in-large-file" title="Permanent link">&para;</a></h2>
<p>either <code>q</code> or <code>u</code> does not make differences for deleting.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>seq<span class="w"> </span>1e7<span class="w"> </span>&gt;<span class="w"> </span>test.txt
$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>sed<span class="w"> </span>-iu<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2">,</span><span class="nv">$l2</span><span class="s2"> d&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>

real<span class="w">    </span>0m26.481s
user<span class="w">    </span>0m5.558s
sys<span class="w"> </span>0m20.592s

$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>sed<span class="w"> </span>-iu<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2">,</span><span class="nv">$l2</span><span class="s2"> d; </span><span class="nv">$l2</span><span class="s2"> q&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>

real<span class="w">    </span>0m26.560s
user<span class="w">    </span>0m5.611s
sys<span class="w"> </span>0m20.566s

$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2">,</span><span class="nv">$l2</span><span class="s2"> d; </span><span class="nv">$l2</span><span class="s2"> q&quot;</span><span class="w"> </span>test.txt<span class="w"> </span>

real<span class="w">    </span>0m27.161s
user<span class="w">    </span>0m5.682s
sys<span class="w"> </span>0m21.266s
</code></pre></div>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span>sed<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$l1</span><span class="s2">,</span><span class="nv">$l2</span><span class="s2"> d&quot;</span><span class="w"> </span>&lt;<span class="w"> </span>test.txt
<span class="w">  </span>perl<span class="w"> </span>-le<span class="w"> </span><span class="s1">&#39;truncate STDOUT, tell STDOUT&#39;</span>
<span class="o">}</span><span class="w"> </span><span class="m">1</span>&lt;&gt;<span class="w"> </span>test.txt

real<span class="w">    </span>0m0.983s
user<span class="w">    </span>0m0.913s
sys<span class="w"> </span>0m0.069s

$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>test.txt
<span class="m">9999949</span><span class="w"> </span>test.txt
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>在 <code>wc</code> 中文件前面插入 <code>&lt;</code> 则不会返回文件名，即 <code>wc -l &lt; test.txt</code>. 另见 <a href="https://unix.stackexchange.com/questions/154322/how-to-display-the-number-of-lines-words-and-characters-in-separate-lines"><img alt="🔗" class="twemoji" src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f517.svg" title=":link:" /></a></p>
</div>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span>head<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">$l1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="k">))</span><span class="s2">&quot;</span>
<span class="w">  </span>head<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">$l2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">$l1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="w">  </span>cat
<span class="w">  </span>perl<span class="w"> </span>-le<span class="w"> </span><span class="s1">&#39;truncate STDOUT, tell STDOUT&#39;</span>
<span class="o">}</span><span class="w"> </span>&lt;<span class="w"> </span>test.txt<span class="w"> </span><span class="m">1</span>&lt;&gt;<span class="w"> </span>test.txt2

real<span class="w">    </span>0m0.069s
user<span class="w">    </span>0m0.007s
sys<span class="w"> </span>0m0.061s

$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>test.txt
<span class="m">10000000</span><span class="w"> </span>test.txt
$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>test.txt2
<span class="m">9999949</span><span class="w"> </span>test.txt2
</code></pre></div>
<p>where we open two file descriptors to the files, </p>
<ul>
<li>one in read-only mode using <code>&lt; test.txt</code> short for <code>0&lt; test.txt</code></li>
<li>one in read-write mode using <code>1&lt;&gt; test.txt2</code> (<code>&lt;&gt; file</code> would be <code>0&lt;&gt; file</code>)</li>
</ul>
<p>then just treat <code>fd0</code> as the input and <code>fd1</code> as the output. </p>
<ul>
<li>the first <code>head</code> reads first <code>$l1 - 1</code> lines from <code>fd0</code> and write that to <code>fd1</code></li>
<li>the second <code>head</code> removes the middle lines from <code>fd0</code> but <code>fd1</code> retains.</li>
<li>the following <code>cat</code> reads the remaining lines from <code>fd0</code> to <code>fd1</code></li>
<li><code>cat</code> will return when it reaches the end of file on <code>fd0</code>, but <code>fd1</code> will point to somewhere in the file that has not been overwritten yet. What we need is to truncate the file at the exact location where that <code>fd1</code> points to now. That&rsquo;s done with the <code>ftruncate</code> system call. <code>tell STDOUT</code> gives us the current cursor position associated with <code>fd1</code>. And we truncate the file at the offset using perl&rsquo;s interface to the <code>ftruncate</code> system call: <code>truncate</code>. The <a href="https://perldoc.perl.org/functions/truncate">usage</a> is that</li>
</ul>
<div class="highlight"><pre><span></span><code>truncate<span class="w"> </span>FILEHANDLE,LENGTH
truncate<span class="w"> </span>EXPR,LENGTH
<span class="w">    </span>Truncates<span class="w"> </span>the<span class="w"> </span>file<span class="w"> </span>opened<span class="w"> </span>on<span class="w"> </span>FILEHANDLE,<span class="w"> </span>or<span class="w"> </span>named<span class="w"> </span>by<span class="w"> </span>EXPR,<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span>length.
</code></pre></div>
<p>refer to <a href="https://unix.stackexchange.com/questions/66730/is-there-a-faster-way-to-remove-a-line-given-a-line-number-from-a-file">Is there a faster way to remove a line (given a line number) from a file?</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In the reference, the author wrote <code>&lt; file 1&lt;&gt; file</code>, which might be confusing that he used the same file, then it would throws an error,</p>
<blockquote>
<p>cat: -: input file is output file</p>
</blockquote>
<p>Actually, I think he wanted to represent two files comparing to the first solution he mentioned, in which only single file used, and he warned that &ldquo;Dangerous as you&rsquo;ve no backup copy there.&rdquo;</p>
<p>Here is another discussion on <a href="https://unix.stackexchange.com/questions/437179/why-cant-an-input-file-be-an-output-file">Why can&rsquo;t an input file be an output file? - Unix &amp; Linux Stack Exchange</a></p>
<p>I also run the third solution, but the lines are not deleted. There might be some incompatible reasons.</p>
</div>
<h2 id="redirection-and-file-descriptor">Redirection and File Descriptor<a class="headerlink" href="#redirection-and-file-descriptor" title="Permanent link">&para;</a></h2>
<h3 id="hide-output-from-bg-process">hide output from bg process<a class="headerlink" href="#hide-output-from-bg-process" title="Permanent link">&para;</a></h3>
<p>Note that</p>
<blockquote>
<p>when you put &amp; the output - both stdout and stderr - will still be printed onto the screen.</p>
<p>If you do not want to see any output on the screen, redirect both stdout and stderr to a file by:</p>
</blockquote>
<p><div class="highlight"><pre><span></span><code>myscript<span class="w"> </span>&gt;<span class="w"> </span>~/myscript.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>
or just</p>
<div class="highlight"><pre><span></span><code>myscript<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>
<p>refer to <a href="https://askubuntu.com/questions/662817/why-can-i-see-the-output-of-background-processes">Why can I see the output of background processes?</a></p>
<p>Specifically, integer <code>1</code> stands for <code>stdout</code> file descriptor, while <code>2</code> represents <code>stderr</code> file descriptor (refer to <a href="https://askubuntu.com/a/1031424">How to redirect stderr to a file</a>).</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>Hello<span class="w"> </span>World<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</code></pre></div>
<p>is same as</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>Hello<span class="w"> </span>World<span class="w"> </span><span class="m">1</span>&gt;<span class="w"> </span>/dev/null
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Formally, this is called redirecting output: <code>[n]&gt;[|]word</code>, if <code>n</code> is not specified, it is the <strong>standard output (fd 1)</strong>.</p>
<p>Similarly,</p>
<ul>
<li>redirecting input: <code>[n]&lt;word</code>, if <code>n</code> is not specified, it is the <strong>standard input (fd 0)</strong></li>
<li>appending redirected output: <code>[n]&gt;&gt;word</code>, if <code>n</code> is not specified, it is the <strong>standard output (fd 1)</strong></li>
</ul>
</div>
<p><strong>As for spacing</strong>, integer is right next to redirection operator, but file can either be next to redirection operator or not, i.e., <code>command 2&gt;/dev/null</code> or <code>command 2&gt; /dev/null</code>.</p>
<p>The classical operator, <code>command &gt; file</code> only redirects standard output, <a href="https://askubuntu.com/a/625230">several choices to redirect stderr</a>,</p>
<ul>
<li>Redirect stdout to one file and stderr to another file</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">command</span><span class="w"> </span>&gt;<span class="w"> </span>out<span class="w"> </span><span class="m">2</span>&gt;<span class="w"> </span>error
</code></pre></div>
<ul>
<li>Redirect stdout to a file, and then redirect stderr to stdout <strong>NO spacings in <code>2&gt;&amp;1</code></strong></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">command</span><span class="w"> </span>&gt;<span class="w"> </span>out<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</code></pre></div>
<ul>
<li>Redirect both to a file (not supported by all shells, but <code>bash</code> is OK)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">command</span><span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>out
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Formally, this is called redirecting <strong>standard output (fd 1)</strong> and <strong>standard error (fd 2)</strong>: <code>&amp;&gt;word</code> or <code>&gt;&amp;word</code>, but the first one is preferred, and it is equivalent to <code>&gt;word 2&gt;&amp;1</code>.</p>
<p>A related one is appending standard output and standard error: <code>&amp;&gt;&gt;word</code>, which is equivalent to <code>&gt;&gt;word 2&gt;&amp;1</code></p>
<p><a href="https://askubuntu.com/a/635069">In more technical terms</a>, <code>[n]&gt;&amp;word</code> is called <a href="https://pubs.opengroup.org/onlinepubs/009695399/utilities/xcu_chap02.html#tag_02_07_06">Duplicating Output File Descriptor</a>:</p>
<ul>
<li><code>[n]&lt;&amp;word</code> is used to duplicate input file descriptors. If <code>word</code> expands to one or more digits, the file descriptor denoted by <code>n</code> is made to be a copy of that file descriptor.</li>
<li><code>[n]&gt;&amp;word</code> is used to duplicate output file descriptors.</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The order of redirections is significant. For example,
<div class="highlight"><pre><span></span><code>ls<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>dirlist
</code></pre></div>
directs only the standard output to file <code>dirlist</code>, because the standard error was made a copy of the standard output before the standard output was redirected to <code>dirlist</code>.</p>
</div>
<p>We can <a href="https://stackoverflow.com/questions/418896/how-to-redirect-output-to-a-file-and-stdout">redirect output to a file and stdout simultaneously</a></p>
<div class="highlight"><pre><span></span><code>program<span class="w"> </span><span class="o">[</span>arguments...<span class="o">]</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>outfile
</code></pre></div>
<p>Other kinds of redirections can be found in the official documentation, <a href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html">3.6 Redirections</a></p>
<ul>
<li>here documents</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">[</span>n<span class="o">]</span>&lt;&lt;<span class="o">[</span>-<span class="o">]</span>word
<span class="w">    </span>here-document
delimiter
</code></pre></div>
<p>for example, <a href="https://github.com/szcf-weiya/Cell-Video/blob/14a7dac4cd5c4bbfbf31d80eead85712eb8ba55a/DP/parallel_oracle2.sh#L5-L12">HELP_USAGE</a></p>
<ul>
<li>here strings: <code>[n]&lt;&lt;&lt; word</code></li>
<li>moving file descriptors: <code>[n]&lt;&amp;digit-</code> (or <code>[n]&gt;&amp;digit-</code>) moves the fd <code>digit</code> to fd <code>n</code></li>
<li>opening fd for reading and writing: <code>[n]&lt;&gt;word</code>, the default is fd 0 if <code>n</code> is not specified.</li>
</ul>
<h3 id="select-lines-based-on-2nd-file">select lines based on 2nd file<a class="headerlink" href="#select-lines-based-on-2nd-file" title="Permanent link">&para;</a></h3>
<p>Given an input file,</p>
<div class="highlight"><pre><span></span><code>a
b
b
c
c
c
d
e
f
f
g
</code></pre></div>
<p>and given the duplicated index file, where the second column is the starting index for duplicates, and the first column is the corresponding number of duplicates. </p>
<p>The goal is to delete the duplicated records but only keep one of them. Although </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>uniq<span class="w"> </span>input.txt
</code></pre></div>
<p>can finish the work. But if there are multiple columns in <code>input.txt</code> and the uniqueness is determined by several selected index. It might be convenient to keep the duplicated index (or the corresponding unique index).</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span>
<span class="w">    </span><span class="nv">lastid</span><span class="o">=</span><span class="m">0</span>
<span class="w">    </span><span class="nv">lastn</span><span class="o">=</span><span class="m">1</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>n<span class="w"> </span>id<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$n</span>,<span class="w"> </span><span class="nv">$id</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span><span class="nv">retain</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$id</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">(</span><span class="nv">$lastid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$lastn</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="k">))</span>
<span class="w">        </span><span class="nv">remove</span><span class="o">=</span><span class="k">$((</span><span class="nv">$n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$n</span><span class="s2">, </span><span class="nv">$id</span><span class="s2">, retain </span><span class="nv">$retain</span><span class="s2">, remove </span><span class="nv">$remove</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">        </span>head<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$retain</span><span class="s2">&quot;</span><span class="w"> </span>&lt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="w">        </span><span class="c1"># head -n $(($id - 1))</span>
<span class="w">        </span>head<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$remove</span><span class="s2">&quot;</span><span class="w"> </span>&lt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="w">        </span><span class="nv">lastn</span><span class="o">=</span><span class="nv">$n</span>
<span class="w">        </span><span class="nv">lastid</span><span class="o">=</span><span class="nv">$id</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>duplicated.idx<span class="w"> </span><span class="c1"># DO USE `3&lt;` here, otherwise while read from input.txt</span>
<span class="w">    </span>cat<span class="w"> </span>&lt;<span class="p">&amp;</span><span class="m">3</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="w">    </span>perl<span class="w"> </span>-le<span class="w"> </span><span class="s1">&#39;truncate STDOUT, tell STDOUT&#39;</span>
<span class="o">}</span><span class="w"> </span><span class="m">3</span>&lt;<span class="w"> </span>input.txt<span class="w"> </span><span class="m">1</span>&lt;&gt;<span class="w"> </span>out.txt
</code></pre></div>
<p>refer to</p>
<ul>
<li><a href="https://unix.stackexchange.com/questions/66730/is-there-a-faster-way-to-remove-a-line-given-a-line-number-from-a-file">Is there a faster way to remove a line (given a line number) from a file?</a></li>
<li><a href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html">3.6 Redirections</a></li>
</ul>
<h2 id="vs"><code>&amp;&amp;</code> vs <code>;</code><a class="headerlink" href="#vs" title="Permanent link">&para;</a></h2>
<ul>
<li><code>cmd1 &amp;&amp; cmd2</code>: if <code>cmd1</code> failed, then <code>cmd2</code> would not execute</li>
<li><code>cmd1 ; cmd2</code>: if <code>cmd1</code> failed, <code>cmd2</code> will still execute</li>
</ul>
<p>so use <code>&amp;&amp;</code> when <code>cmd1</code> is to enter the folder, refer to <a href="https://stackoverflow.com/questions/8899737/crontab-run-in-directory">Crontab - Run in directory - Stack Overflow</a></p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 7, 2022</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">March 9, 2018</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017-2023 weiya
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/szcf-weiya" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://esl.hohoweiya.xyz" target="_blank" rel="noopener" title="esl.hohoweiya.xyz" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hohoweiya.xyz" target="_blank" rel="noopener" title="hohoweiya.xyz" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40h-16c-1.1 0-2.2 0-3.3-.1-1.4.1-2.8.1-4.2.1H392c-22.1 0-40-17.9-40-40v-88c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v88c0 22.1-17.9 40-40 40h-55.9c-1.5 0-3-.1-4.5-.2-1.2.1-2.4.2-3.6.2h-16c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9.1-2.8v-69.6H32c-18 0-32-14-32-32.1 0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7l255.4 224.5c8 7 12 15 11 24z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://stats.hohoweiya.xyz" target="_blank" rel="noopener" title="stats.hohoweiya.xyz" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M168 80c-13.3 0-24 10.7-24 24v304c0 8.4-1.4 16.5-4.1 24H440c13.3 0 24-10.7 24-24V104c0-13.3-10.7-24-24-24H168zM72 432c13.3 0 24-10.7 24-24V104c0-39.8 32.2-72 72-72h272c39.8 0 72 32.2 72 72v304c0 39.8-32.2 72-72 72H72c-39.8 0-72-32.2-72-72V112c0-13.3 10.7-24 24-24s24 10.7 24 24v296c0 13.3 10.7 24 24 24zm104-296c0-13.3 10.7-24 24-24h208c13.3 0 24 10.7 24 24v80c0 13.3-10.7 24-24 24H200c-13.3 0-24-10.7-24-24v-80zm24 136h64c13.3 0 24 10.7 24 24s-10.7 24-24 24h-64c-13.3 0-24-10.7-24-24s10.7-24 24-24zm144 0h64c13.3 0 24 10.7 24 24s-10.7 24-24 24h-64c-13.3 0-24-10.7-24-24s10.7-24 24-24zm-144 80h64c13.3 0 24 10.7 24 24s-10.7 24-24 24h-64c-13.3 0-24-10.7-24-24s10.7-24 24-24zm144 0h64c13.3 0 24 10.7 24 24s-10.7 24-24 24h-64c-13.3 0-24-10.7-24-24s10.7-24 24-24z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://blog.csdn.net/szcf715" target="_blank" rel="noopener" title="blog.csdn.net" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M64 80c-8.8 0-16 7.2-16 16v320c0 8.8 7.2 16 16 16h224v-80c0-17.7 14.3-32 32-32h80V96c0-8.8-7.2-16-16-16H64zm224 400H64c-35.3 0-64-28.7-64-64V96c0-35.3 28.7-64 64-64h320c35.3 0 64 28.7 64 64v229.5c0 17-6.7 33.3-18.7 45.3l-90.5 90.5c-12 12-28.3 18.7-45.3 18.7H288z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:szcfweiya@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16H64zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.top"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b78d2936.min.js"></script>
      
        <script src="../javascripts/baiduzhanzhang.js"></script>
      
        <script src="../javascripts/extra.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>